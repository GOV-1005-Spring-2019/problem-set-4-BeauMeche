---
title: "Problem Set #4"
author: "Beau Meche"
date: "02-25-2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(gt)
library(devtools)
library(lubridate)
```

#Question 1

```{r echo = FALSE, message=FALSE}
poll <- read_csv(file = "ps_4_elections-poll-nc09-3.csv")

#Question 1
#assigning this set of filters etc. to a name for simmplicity in the first set of MadLibs
W <- poll %>%
  #interested in sum of supporters per party for a while, so grouping my aim of responses
  group_by(response) %>%
  count() %>%
  # flipping the col. names for pulling ease below
  spread(response, n)

# ML #1: dem voters
# using pre-filtered data
dems <- W %>%
  # already set up with a sum above, just gotta grab
  pull(Dem)

#ML #2: republicans more than undecideds
#using pre-filtered data
ML2 <- W %>%
  # already have the sums, now I need a new variable name to pull the new sum with
  mutate(r_u = Rep - Und) %>%
  pull(r_u)

#ML #3: number of gender that didnt match gender combined
ML3 <- poll %>%
  filter(gender != gender_combined) %>%
  count() %>% pull (n)

#ML #4: race column discrepancies
ML4 <- poll %>%
  select(race_eth, file_race_black) %>%
  filter(race_eth == "White" &
         file_race_black != "White") %>%
  count() %>% pull(n)

#ML #5: fastest Rep vs. fastest Dem
ML5 <- poll %>%
  filter(response == "Dem" | response == "Rep") %>%
  group_by(response) %>%
  summarize(time = min(timestamp)) %>%
  spread(response, time) %>%
  mutate(diff = round(Rep - Dem, 0)) %>%
  select(diff)
```
There were `r dems` respondents who supported the Democratic candidate. 

There were `r ML2` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (`gender` and `gender_combined`). There are `r ML3` individuals for whom these variables have different values. 

There are `r ML4` respondents listed as "White" under `race_eth` who are not listed as "White" under `file_race_black`. 

The first `response` of Rep came `r ML5` minutes (rounded to the nearest minute) before the first `response` of Dem. 

#Question 2

```{r echo=FALSE, message=FALSE}
chart <- poll %>%
  select(response, race_eth, final_weight) %>%
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>%
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black", "Hispanic", "Asian", "Other")))%>%
  group_by(race_eth, response) %>%
  summarize(total = sum(final_weight)) %>%
  spread(key = response, value = total, fill = 0) %>%
  ungroup()

chart %>%
  mutate(all = Dem+Rep+Und+`3`)%>%
  mutate(Dem = Dem/all) %>%
  mutate(Rep = Rep/all) %>%
  mutate(Und = Und/all) %>%
  select(-all, -`3`) %>%
  ungroup() %>%
  na_if(0) %>%
  gt() %>%
fmt_percent(columns = vars(Dem, Rep, Und), decimals = 0) %>%
    tab_header(
        title = ("Demographic Polling Results in North Carolina's 9th Congressional District")) %>%
    tab_source_note(source_note = "New York Times Upshot/Siena College 2018 live polls") %>%
    cols_label(
      race_eth = "",
      Dem = "DEM.",
      Rep = "REP.",
      Und = "UND.")
```


#Question 3

```{r echo=FALSE, message=FALSE}
ew <- poll %>%
select(educ, final_weight) %>%
  filter(educ != "[DO NOT READ] Refused") %>%
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", 
                                    "Some college or trade school", "Bachelors' degree", "Graduate or Professional Degree"))) %>%
  ggplot(aes(x = educ, y = final_weight)) + geom_violin() + coord_flip() +    geom_jitter(alpha = .4, width = .22) + 
  labs(title ="More Educated Matter Less in North Carolina 9th",
       subtitle ="Poll gives more weight to people who are less likely to participate in polls",
       caption = "New York Times Upshot/Siena College 2018 live polls")+
  xlab(NULL) + 
  ylab("Weight Given to Respondent in Calculating Poll Results")
ew
```


#Question 4

```{r echo = FALSE, message=FALSE}
q4 <- poll %>%
  select(ager, timestamp) %>%
  filter(ager != "[DO NOT READ] Refused")%>%
  group_by(timestamp, ager) %>%
  ggplot(aes(x = timestamp, color = ager)) + geom_histogram(show.legend = FALSE)+
  facet_wrap(~ager) + 
  ylab("Responses") +xlab(NULL) +
  labs(title = "Responses by Age Group Over Time",
       subtitle = "who procrastinates the most?", 
       caption = "Deviance from the date line indicates the time of the day")
q4
```

#Colleagues
Debora G., Diego M., Chris O., Dillon (CA)


